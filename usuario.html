<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Usuário - E-C virtual</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header></header>
  <nav>
    <div class="nav-logo">E-C virtual</div>
    <div class="nav-links">
      <a href="home.html">Home</a>
      <a href="perfil.html">Perfil</a>
      <a href="contato.html">Contato</a>
      <a href="usuario.html" id="usuarioLink">Usuário</a>
      <a href="index.html">Sair</a>
    </div>
  </nav>
  <main>
    <div class="user-card">
      <img src="https://avatars.githubusercontent.com/u/114893803?v=4" alt="Foto do Usuário">
      <h2>Fulano</h2>
      <div class="user-info"><strong>Email:</strong> <span id="userEmail"></span></div>
      <div class="user-info"><strong>Telefone:</strong> (82) 91234-5678</div>
      <div class="user-info"><strong>Endereço:</strong> Rua Exemplo, 123, Maceió-AL</div>
    </div>
    <section class="cart-section">
      <h3>Meu Carrinho</h3>
      <ul class="cart-list" id="cartList"></ul>
      <div class="total-section" id="totalSection"></div>
      <div class="shipping-section">
        <label for="cep">Calcule o frete (CEP):</label>
        <input type="text" id="cep" placeholder="Digite seu CEP">
        <button type="button" onclick="calculateShipping()">Calcular Frete</button>
        <div class="shipping-cost" id="shippingCost"></div>
      </div>
      <button class="purchase-btn" onclick="finalizePurchase()">Finalizar Compra</button>
    </section>
  </main>
  <footer>
    <span>&copy; 2025 E-C virtual</span>
  </footer>
  <script>
    function getCartItems() {
      return JSON.parse(localStorage.getItem('cart')) || [];
    }

    function renderCart() {
      const cartItems = getCartItems();
      const cartList = document.getElementById('cartList');
      const totalSection = document.getElementById('totalSection');
      cartList.innerHTML = '';
      let total = 0;

      if (cartItems.length === 0) {
        cartList.innerHTML = '<li class="empty-cart">Seu carrinho está vazio.</li>';
        totalSection.textContent = '';
        return;
      }

      cartItems.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span class="item-name">${item.name}</span>
          <span class="item-qtd">Qtd: ${item.qtd}</span>
          <span class="item-price">R$ ${(item.price * item.qtd).toFixed(2)}</span>
        `;
        cartList.appendChild(li);
        total += item.price * item.qtd;
      });

      totalSection.textContent = `Total: R$ ${total.toFixed(2)}`;
    }

    function calculateShipping() {
      const cep = document.getElementById('cep').value.trim();
      const shippingCostDiv = document.getElementById('shippingCost');
      if (!cep || cep.length < 8) {
        shippingCostDiv.textContent = "Digite um CEP válido.";
        shippingCostDiv.style.color = "#e74c3c";
        return;
      }

      let shipping = 0;
      if (cep.startsWith("57")) {
        shipping = 10.00;
      } else if (cep.startsWith("01") || cep.startsWith("02")) {
        shipping = 25.00;
      } else {
        shipping = 40.00;
      }
      shippingCostDiv.textContent = `Frete: R$ ${shipping.toFixed(2)}`;
      shippingCostDiv.style.color = "#357ae8";
    }

    function finalizePurchase() {
      alert("Compra finalizada com sucesso! Obrigado por comprar conosco.");
    }

    window.onload = function() {
      renderCart();
      
      const params = new URLSearchParams(window.location.search);
      const email = params.get('email');
      if (email) {
        document.getElementById('userEmail').textContent = email;
      } else {
        document.getElementById('userEmail').textContent = "fulano@email.com";
      }
    };
  </script>
</body>
</html>